<!DOCTYPE html>
<html>

<head>
  <title>BerkutAR</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <!-- <script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar-threex-location-only.js'></script> -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar.js"></script>
  <script type='text/javascript'
    src='https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js'></script>
  <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
</head>

<body>
  <a-scene vr-mode-ui='enabled: false' arjs='sourceType: webcam; videoTexture: true; debugUIEnabled: false'
    renderer='antialias: true; alpha: true'>
    <a-camera gps-new-camera='gpsMinDistance: 5'></a-camera>
  </a-scene>


  <script type="text/javascript">
    window.onload = () => {
      const el = document.querySelector("[gps-new-camera]");
      const scene = document.querySelector("a-scene");

      el.addEventListener("gps-camera-update-position", async (e) => {
        let markers = document.querySelectorAll("[data='marker']");
        markers.forEach(marker => { marker.remove(); });

        let response = await fetch(`https://faweprivateberkutpoiservice.azurewebsites.net/api/FindNearestPoint?code=bso09L9jod196239YDfawVwoXZ0N6rfwSbwH0B6p9HcnAzFuj82wmA==&lat=${e.detail.position.latitude}&long=${e.detail.position.longitude}`);
        let pois = await response.json();
        pois.forEach(poi => {
          let nodes = createElementsFromHTML(poi.content);

          nodes.forEach(node => {
            scene.appendChild(node);
          });
        });
      });
    };

    function createElementsFromHTML(htmlString) {
      var div = document.createElement('div');
      div.innerHTML = htmlString.trim();
      return div.childNodes
    }
  </script>
</body>

</html>